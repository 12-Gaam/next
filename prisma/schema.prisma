generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                String             @id @default(cuid())
  username          String             @unique
  password          String
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  email             String             @unique
  fullName          String
  gaamId            String?
  status            RegistrationStatus @default(PENDING)
  verificationNotes String?
  verifiedAt        DateTime?
  verifiedById      String?
  verifiedBy        User?              @relation("UserVerification", fields: [verifiedById], references: [id])
  verifiedUsers     User[]             @relation("UserVerification")
  contacts          Contact[]
  gaamsManaged      GaamAdmin[]        @relation("GaamAdmins")
  otp               String?
  otpExpiresAt      DateTime?
  contacts          Contact[]
  gaamsManaged      Gaam[]             @relation("GaamAdmins")
  gaam              Gaam?              @relation(fields: [gaamId], references: [id])
  verifiedBy        User?              @relation("UserVerification", fields: [verifiedById], references: [id])
  verifiedUsers     User[]             @relation("UserVerification")
}

model Gaam {
  id        String        @id @default(cuid())
  name      String        @unique
  slug      String        @unique
  admins    GaamAdmin[]   @relation("GaamAdmins")
  members   User[]
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
}

model GaamAdmin {
  id        String   @id @default(cuid())
  gaamId    String
  adminId   String
  gaam      Gaam     @relation("GaamAdmins", fields: [gaamId], references: [id], onDelete: Cascade)
  admin     User     @relation("GaamAdmins", fields: [adminId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([gaamId, adminId])
  @@index([gaamId])
  @@index([adminId])
}

model CountryMaster {
  id        String        @id @default(cuid())
  name      String        @unique
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  contacts  Contact[]
  states    StateMaster[]
}

model StateMaster {
  id        String        @id @default(cuid())
  name      String
  countryId String
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  cities    CityMaster[]
  contacts  Contact[]
  country   CountryMaster @relation(fields: [countryId], references: [id], onDelete: Cascade)
}

model CityMaster {
  id        String      @id @default(cuid())
  name      String
  stateId   String
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  state     StateMaster @relation(fields: [stateId], references: [id], onDelete: Cascade)
}

model EducationMaster {
  id        String    @id @default(cuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  contacts  Contact[]
}

model ProfessionMaster {
  id        String    @id @default(cuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  contacts  Contact[]
}

model Contact {
  id               String            @id @default(cuid())
  firstname        String
  middlename       String?
  lastname         String?           @default("Patel")
  gender           String
  gaam             String
  currentAddress   String
  countryId        String?
  stateId          String?
  cityId           String?
  phone            String            @unique
  email            String?           @unique
  dob              DateTime?
  educationId      String?
  otherEducation   String?
  professionId     String?
  otherProfession  String?
  website          String?
  profilePic       String?
  familyPhoto      String?
  fb               String?
  linkedin         String?
  insta            String?
  tiktok           String?
  twitter          String?
  snapchat         String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  spouseFirstName  String?
  spouseMiddleName String?
  spouseLastName   String?
  fatherFirstName  String?           @default("")
  fatherMiddleName String?
  fatherLastName   String?
  motherFirstName  String?           @default("")
  motherMiddleName String?
  motherLastName   String?
  maritalStatus    String?
  is18Plus         Boolean?          @default(false)
  countryCode      String?           @default("+1")
  userId           String?
  country          CountryMaster?    @relation(fields: [countryId], references: [id])
  education        EducationMaster?  @relation(fields: [educationId], references: [id])
  profession       ProfessionMaster? @relation(fields: [professionId], references: [id])
  state            StateMaster?      @relation(fields: [stateId], references: [id])
  user             User?             @relation(fields: [userId], references: [id])
  children         ContactChild[]
  siblings         ContactSibling[]
}

model ContactChild {
  id         String   @id @default(cuid())
  contactId  String
  gender     String
  age        Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  firstName  String?  @default("")
  middleName String?
  lastName   String?
  contact    Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)
}

model ContactSibling {
  id         String   @id @default(cuid())
  contactId  String
  gender     String
  age        Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  firstName  String?  @default("")
  middleName String?
  lastName   String?
  contact    Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)
}

enum UserRole {
  SUPER_ADMIN
  GAAM_ADMIN
  MEMBER
}

enum RegistrationStatus {
  PENDING
  APPROVED
  REJECTED
}
