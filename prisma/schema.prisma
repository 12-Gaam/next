generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum UserRole {
  SUPER_ADMIN
  GAAM_ADMIN
  MEMBER
}

enum RegistrationStatus {
  PENDING
  APPROVED
  REJECTED
}

model User {
  id                String             @id @default(cuid())
  fullName          String
  email             String             @unique
  username          String             @unique
  password          String
  role              UserRole           @default(MEMBER)
  status            RegistrationStatus @default(PENDING)
  gaamId            String?
  gaam              Gaam?              @relation(fields: [gaamId], references: [id])
  verificationNotes String?
  verifiedAt        DateTime?
  verifiedById      String?
  verifiedBy        User?              @relation("UserVerification", fields: [verifiedById], references: [id])
  verifiedUsers     User[]             @relation("UserVerification")
  contacts          Contact[]
  gaamsManaged      GaamAdmin[]        @relation("GaamAdmins")
  otp               String?
  otpExpiresAt      DateTime?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
}

model Gaam {
  id        String        @id @default(cuid())
  name      String        @unique
  slug      String        @unique
  admins    GaamAdmin[]   @relation("GaamAdmins")
  members   User[]
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
}

model GaamAdmin {
  id        String   @id @default(cuid())
  gaamId    String
  adminId   String
  gaam      Gaam     @relation("GaamAdmins", fields: [gaamId], references: [id], onDelete: Cascade)
  admin     User     @relation("GaamAdmins", fields: [adminId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([gaamId, adminId])
  @@index([gaamId])
  @@index([adminId])
}

model CountryMaster {
  id        String        @id @default(cuid())
  name      String        @unique
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  contacts  Contact[]
  states    StateMaster[]
}

model StateMaster {
  id        String        @id @default(cuid())
  name      String
  countryId String
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  cities    CityMaster[]
  contacts  Contact[]
  country   CountryMaster @relation(fields: [countryId], references: [id], onDelete: Cascade)
}

model CityMaster {
  id        String      @id @default(cuid())
  name      String
  stateId   String
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  state     StateMaster @relation(fields: [stateId], references: [id], onDelete: Cascade)
}

model EducationMaster {
  id        String    @id @default(cuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  contacts  Contact[]
}

model ProfessionMaster {
  id        String    @id @default(cuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  contacts  Contact[]
}

model Contact {
  id               String            @id @default(cuid())
  userId           String?
  firstname        String
  middlename       String?
  lastname         String?           @default("Patel")
  spouseFirstName  String?
  spouseMiddleName String?
  spouseLastName   String?
  fatherFirstName  String?           @default("")
  fatherMiddleName String?
  fatherLastName   String?
  motherFirstName  String?           @default("")
  motherMiddleName String?
  motherLastName   String?
  gender           String
  maritalStatus    String?
  is18Plus         Boolean?          @default(false)
  gaam             String
  currentAddress   String
  countryId        String?
  country          CountryMaster?    @relation(fields: [countryId], references: [id])
  stateId          String?
  state            StateMaster?      @relation(fields: [stateId], references: [id])
  cityId           String?
  phone            String            @unique
  countryCode      String?           @default("+1")
  email            String?           @unique
  dob              DateTime?
  educationId      String?
  education        EducationMaster?  @relation(fields: [educationId], references: [id])
  otherEducation   String?
  professionId     String?
  profession       ProfessionMaster? @relation(fields: [professionId], references: [id])
  otherProfession  String?
  website          String?
  profilePic       String?
  familyPhoto      String?
  fb               String?
  linkedin         String?
  insta            String?
  tiktok           String?
  twitter          String?
  snapchat         String?
  children         ContactChild[]
  siblings         ContactSibling[]
  user             User?             @relation(fields: [userId], references: [id], onDelete: SetNull)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
}

model ContactChild {
  id         String   @id @default(cuid())
  contactId  String
  contact    Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)
  firstName  String?  @default("")
  middleName String?
  lastName   String?
  gender     String
  age        Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model ContactSibling {
  id         String   @id @default(cuid())
  contactId  String
  contact    Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)
  firstName  String?  @default("")
  middleName String?
  lastName   String?
  gender     String
  age        Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}
